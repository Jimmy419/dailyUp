<!DOCTYPE html>
<html>
<head>
    <title>asdf</title>
    <link href='__PUBLIC__/plugins/font-awesome/css/font-awesome.min.css' rel="stylesheet" type="text/css" />
    <link href='__PUBLIC__/plugins/bootstrap/css/bootstrap.min.css' rel="stylesheet" type="text/css" />
    <link href='__PUBLIC__/plugins/datepicker/css/bootstrap-datetimepicker.min.css' rel="stylesheet" type="text/css" />
    <link href="../Public/css/index.css" rel="stylesheet" type="text/css" />
</head>
<body class="indexPage">
    <div class="header">
        <div>{$Think.session.username} [&nbsp;<a href="javascript:void(0)" onclick="logout()" id="logoutLink" class="left-font01">退出</a>&nbsp;]</div>
        <div><a href="{:U('index')}" class="left-font01">主页</a></div>
    </div>
    <div class="content">
        <!-- onsubmit="return false" -->
        <form id="addDataForm" onsubmit="return false" action="{:U('insert')}" method="post">
            <label class="form-label">编辑column</label>
            <div class="form-control">{$column.mclass}-({$column.name})</div>
            <!-- <select class="form-control" name="carlist" id="colVal">
                <volist name='colums' id="col">
                    <option value="{$col[id]}">{$col[name]}({$col[mclass]})</option>
                </volist>
            </select> -->
            <label class="form-label">值</label>
            <input class="form-control" type="text" name="value" id="iptVal" value="{$currentData.value}">
            <label class="form-label">备注</label>
            <textarea class="form-control" id="remarks">{$currentData.notes}</textarea>
            <label class="form-label">时间</label>
            <div class="control-group">
                <div class="controls input-append date form_date" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                    <input class="form-control" size="16" type="text" value="{$time}" readonly>
                    <span class="add-on"><i class="icon-remove"></i></span>
                    <span class="add-on"><i class="icon-th"></i></span>
                </div>
                <input type="hidden" id="dtp_input2" value="" /><br/>
            </div>
            <button class="button btn-primary form-control" type="submit" style="margin-top:20px;">Submit</button>
        </form>
    </div>
</body>
<script src='__PUBLIC__/plugins/jquery/jquery.min.js'></script>
<script src='__PUBLIC__/plugins/bootstrap/js/bootstrap.min.js'></script>
<script src='__PUBLIC__/plugins/datepicker/js/bootstrap-datetimepicker.min.js'></script>
<script>
    $(function() {      
        $("#logoutLink").click(function(){
            $.ajax({
                url:"{:U('Login/logout')}",
                type:'get',
                success:function(result){
                    if(result.status){
                        window.location.href="{:U('Login/index')}"; 
                    }else{
                        alert("Logout failed!");
                    }
                }
            })              
        })

        $('.form_date').datetimepicker({
            language:  'fr',
            weekStart: 1,
            todayBtn:  1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0
        });

        function fmtDate(obj){
            var date =  new Date(obj);
            var y = 1900+date.getYear();
            var m = "0"+(date.getMonth()+1);
            var d = "0"+date.getDate();
            return y+"-"+m.substring(m.length-2,m.length)+"-"+d.substring(d.length-2,d.length);
        }

        $("#addDataForm").submit(function(e){
            var time = new Date($('#dtp_input2').val()).getTime();
            var data = {
                'uid': {$Think.session.uid},
                'cid':$('#colVal').val(),
                'notes':$('#remarks').val(),
                'value':$('#iptVal').val(),
                'time':time,
                'ctime': new Date().getTime()               
            }
            console.log(data);
            $.ajax({
                url:"{:U('insert')}",
                type:'post',
                data:data,
                success:function(result){
                    // console.log(result);
                    if(result.status){
                        alert("Insert successfully!")
                        window.location.href="{:U('index')}"; 
                    }else{
                        alert(result.errMsg);
                    }
                }
            })              
        });
    });
</script>
</html>