<!DOCTYPE html>
<html>
<head>
	<title>asdf</title>
    <link href='__PUBLIC__/plugins/font-awesome/css/font-awesome.min.css' rel="stylesheet" type="text/css" />
    <link href='__PUBLIC__/plugins/bootstrap/css/bootstrap.min.css' rel="stylesheet" type="text/css" />
    <link href="../Public/css/index.css" rel="stylesheet" type="text/css" />
</head>
<body class="indexPage">
	<div class="header">
		<div>{$Think.session.username} [&nbsp;<a href="javascript:void(0)" onclick="logout()" id="logoutLink" class="left-font01">退出</a>&nbsp;]</div>
        <div><a href="{:U('Columns/index')}">类目</a></div>
        <div><a href="{:U('Tables/index')}">我的表</a></div>
        <div><a href="{:U('Map/index')}">表映射</a></div>
        <div><a href="{:U('Upload/index')}">上传数据</a></div>
	</div>
	<div class="content">
        <volist name='tblist' id="tb">
            <div id='chart{$tb[id]}'></div>
        </volist>
        <div id="container"></div>
        <div>我的数据</div>
        <table class="table table-bordered table-hover">
            <thead>
                <th>id</th>
                <th>Table Name</th>
                <th>Class Id</th>
                <th>所属分类</th>
                <th>列名</th>
                <th>值</th>
                <th>备注</th>
                <th>时间</th>
                <th>填写时间</th>
                <th colspan="2">Setting</th>
            </thead>
            <tbody>
                <volist name='tables' id="table">
                    <tr>
                        <td>{$table[id]}</td>
                        <td>{$table[tablename]}</td>
                        <td>{$table[cid]}</td>
                        <td>{$table[mclass]}</td>
                        <td>{$table[name]}</td>
                        <td>{$table[value]}</td>
                        <td>{$table[notes]}</td>
                        <td>{$table[time]}</td>
                        <td>{$table[ctime]}</td>
                        <td><a href="{:U('edit')}/id/{$table[dataId]}/cid/{$table[cid]}">Edit</a></td>
                        <td><a href="{:U('delete')}/id/{$table[dataId]}">Delete</a></td>
                    </tr>
                </volist>
            </tbody>
        </table>
        <div><a href="{:U('add')}" class="left-font01">添加数据</a></div>
	</div>
</body>
<script src='__PUBLIC__/plugins/jquery/jquery.min.js'></script>
<!-- <script src='__PUBLIC__/plugins/highcharts/jquery-1.8.3.min.js'></script> -->
<script src='__PUBLIC__/plugins/bootstrap/js/bootstrap.min.js'></script>
<script src="__PUBLIC__/plugins/underscore/underscore-min.js"></script>
<!-- <script src='__PUBLIC__/plugins/highcharts/jquery-1.8.3.min.js'></script> -->
<!-- <script src="__PUBLIC__/plugins/highcharts/highcharts.js"></script> -->
<script src="https://code.highcharts.com/highcharts.src.js"></script>
<script src="__PUBLIC__/plugins/highcharts/exporting.js"></script>
<script src="__PUBLIC__/plugins/highcharts/highcharts-zh_CN.js"></script>
<script>
$(function() {   	
    var data = null;
    var tables = null;
	$("#logoutLink").click(function(){
        $.ajax({
            url:"{:U('Login/logout')}",
            type:'get',
            success:function(result){
                if(result.status){
                    window.location.href="{:U('Login/index')}"; 
                }else{
                    alert("Logout failed!");
                }
            }
        })      		
	})

    $.ajax({
        url:"{:U('getDate')}",
        type:'get',
        success:function(result){
            data = result.data;
            tables = result.tables;
            tables.forEach(function(table){
                console.log(table);
                var chartData = [];
                var chartCol = [];
                var chartColId = [];
                var series = [];
                data.forEach(function(val){
                    if(val.id === table.id) {
                        chartData.push(val);
                        chartCol.push(val.name);
                        chartColId.push(val.cid);
                    }
                });
                chartColName = _.uniq(chartCol);
                chartColId = _.uniq(chartColId);
                chartColId.forEach(function(col,colIndex){
                    var itemData = [];
                    chartData.forEach(function(itemDataItem){
                        if(itemDataItem.cid === col){
                            var temp = [
                                itemDataItem.time,
                                itemDataItem.value
                            ];
                            itemData.push(temp);                            
                        }
                    })
                    var chartItem = {
                        name: chartColName[colIndex],
                        data: itemData
                    }
                    series.push(chartItem);
                })

var chart1 = Highcharts.chart('chart'+table.id, {
        chart: {
                type: 'spline'
        },
        title: {
                text: '某地积雪厚度监测'
        },
        subtitle: {
                text: '非规律性时间内的变化'
        },
        xAxis: {
                type: 'datetime',
                title: {
                        text: null
                }
        },
        yAxis: {
                title: {
                        text: '积雪 厚度 (m)'
                },
                min: 0
        },
        tooltip: {
                headerFormat: '<b>{series.name}</b><br>',
                pointFormat: '{point.x:%e. %b}: {point.y:.2f} m'
        },
        plotOptions: {
                spline: {
                        marker: {
                                enabled: true
                        }
                }
        },
        // series: series
        series: [
            {
                name: '2007-2008 冬',
                data: [

                        ['2018-03-05', 0   ],
                        ['2018-03-06', 0.6 ],
                        ['2018-03-07', 0.7 ]

                        // [Date.UTC(1970,  9, 27), 0   ],
                        // [Date.UTC(1970, 10, 10), 0.6 ],
                        // [Date.UTC(1970, 10, 18), 0.7 ],
                        // [Date.UTC(1970, 11,  2), 0.8 ],
                        // [Date.UTC(1970, 11,  9), 0.6 ],
                        // [Date.UTC(1970, 11, 16), 0.6 ],
                        // [Date.UTC(1970, 11, 28), 0.67],
                        // [Date.UTC(1971,  0,  1), 0.81],
                        // [Date.UTC(1971,  0,  8), 0.78],
                        // [Date.UTC(1971,  0, 12), 0.98],
                        // [Date.UTC(1971,  0, 27), 1.84],
                        // [Date.UTC(1971,  1, 10), 1.80],
                        // [Date.UTC(1971,  1, 18), 1.80],
                        // [Date.UTC(1971,  1, 24), 1.92],
                        // [Date.UTC(1971,  2,  4), 2.49],
                        // [Date.UTC(1971,  2, 11), 2.79],
                        // [Date.UTC(1971,  2, 15), 2.73],
                        // [Date.UTC(1971,  2, 25), 2.61],
                        // [Date.UTC(1971,  3,  2), 2.76],
                        // [Date.UTC(1971,  3,  6), 2.82],
                        // [Date.UTC(1971,  3, 13), 2.8 ],
                        // [Date.UTC(1971,  4,  3), 2.1 ],
                        // [Date.UTC(1971,  4, 26), 1.1 ],
                        // [Date.UTC(1971,  5,  9), 0.25],
                        // [Date.UTC(1971,  5, 12), 0   ]
                ]
            }
        ]
});
            })
        }
    })    
// var chart1 = Highcharts.chart('container', {
//         chart: {
//                 type: 'spline'
//         },
//         title: {
//                 text: '某地积雪厚度监测'
//         },
//         subtitle: {
//                 text: '非规律性时间内的变化'
//         },
//         xAxis: {
//                 type: 'datetime',
//                 title: {
//                         text: null
//                 }
//         },
//         yAxis: {
//                 title: {
//                         text: '积雪 厚度 (m)'
//                 },
//                 min: 0
//         },
//         tooltip: {
//                 headerFormat: '<b>{series.name}</b><br>',
//                 pointFormat: '{point.x:%e. %b}: {point.y:.2f} m'
//         },
//         plotOptions: {
//                 spline: {
//                         marker: {
//                                 enabled: true
//                         }
//                 }
//         },
//         series: [{
//                 name: '2007-2008 冬',
//                 // Define the data points. All series have a dummy year
//                 // of 1970/71 in order to be compared on the same x axis. Note
//                 // that in JavaScript, months start at 0 for January, 1 for February etc.
//                 data: [
//                         [Date.UTC(1970,  9, 27), 0   ],
//                         [Date.UTC(1970, 10, 10), 0.6 ],
//                         [Date.UTC(1970, 10, 18), 0.7 ],
//                         [Date.UTC(1970, 11,  2), 0.8 ],
//                         [Date.UTC(1970, 11,  9), 0.6 ],
//                         [Date.UTC(1970, 11, 16), 0.6 ],
//                         [Date.UTC(1970, 11, 28), 0.67],
//                         [Date.UTC(1971,  0,  1), 0.81],
//                         [Date.UTC(1971,  0,  8), 0.78],
//                         [Date.UTC(1971,  0, 12), 0.98],
//                         [Date.UTC(1971,  0, 27), 1.84],
//                         [Date.UTC(1971,  1, 10), 1.80],
//                         [Date.UTC(1971,  1, 18), 1.80],
//                         [Date.UTC(1971,  1, 24), 1.92],
//                         [Date.UTC(1971,  2,  4), 2.49],
//                         [Date.UTC(1971,  2, 11), 2.79],
//                         [Date.UTC(1971,  2, 15), 2.73],
//                         [Date.UTC(1971,  2, 25), 2.61],
//                         [Date.UTC(1971,  3,  2), 2.76],
//                         [Date.UTC(1971,  3,  6), 2.82],
//                         [Date.UTC(1971,  3, 13), 2.8 ],
//                         [Date.UTC(1971,  4,  3), 2.1 ],
//                         [Date.UTC(1971,  4, 26), 1.1 ],
//                         [Date.UTC(1971,  5,  9), 0.25],
//                         [Date.UTC(1971,  5, 12), 0   ]
//                 ]
//         }, {
//                 name: '2008-2009 冬',
//                 data: [
//                         [Date.UTC(1970,  9, 18), 0   ],
//                         [Date.UTC(1970,  9, 26), 0.2 ],
//                         [Date.UTC(1970, 11,  1), 0.47],
//                         [Date.UTC(1970, 11, 11), 0.55],
//                         [Date.UTC(1970, 11, 25), 1.38],
//                         [Date.UTC(1971,  0,  8), 1.38],
//                         [Date.UTC(1971,  0, 15), 1.38],
//                         [Date.UTC(1971,  1,  1), 1.38],
//                         [Date.UTC(1971,  1,  8), 1.48],
//                         [Date.UTC(1971,  1, 21), 1.5 ],
//                         [Date.UTC(1971,  2, 12), 1.89],
//                         [Date.UTC(1971,  2, 25), 2.0 ],
//                         [Date.UTC(1971,  3,  4), 1.94],
//                         [Date.UTC(1971,  3,  9), 1.91],
//                         [Date.UTC(1971,  3, 13), 1.75],
//                         [Date.UTC(1971,  3, 19), 1.6 ],
//                         [Date.UTC(1971,  4, 25), 0.6 ],
//                         [Date.UTC(1971,  4, 31), 0.35],
//                         [Date.UTC(1971,  5,  7), 0   ]
//                 ]
//         }, {
//                 name: '2009-2010 冬',
//                 data: [
//                         [Date.UTC(1970,  9,  9), 0   ],
//                         [Date.UTC(1970,  9, 14), 0.15],
//                         [Date.UTC(1970, 10, 28), 0.35],
//                         [Date.UTC(1970, 11, 12), 0.46],
//                         [Date.UTC(1971,  0,  1), 0.59],
//                         [Date.UTC(1971,  0, 24), 0.58],
//                         [Date.UTC(1971,  1,  1), 0.62],
//                         [Date.UTC(1971,  1,  7), 0.65],
//                         [Date.UTC(1971,  1, 23), 0.77],
//                         [Date.UTC(1971,  2,  8), 0.77],
//                         [Date.UTC(1971,  2, 14), 0.79],
//                         [Date.UTC(1971,  2, 24), 0.86],
//                         [Date.UTC(1971,  3,  4), 0.8 ],
//                         [Date.UTC(1971,  3, 18), 0.94],
//                         [Date.UTC(1971,  3, 24), 0.9 ],
//                         [Date.UTC(1971,  4, 16), 0.39],
//                         [Date.UTC(1971,  4, 21), 0   ]
//                 ]
//         }]
// });

});
</script>
</html>